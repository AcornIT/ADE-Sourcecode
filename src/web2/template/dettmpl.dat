<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<!--------------------------------------------------------------------
* Copyright (C) 2000 by Progress Software Corporation ("PSC"),       *
* 14 Oak Park, Bedford, MA 01730, and other contributors as listed   *
* below.  All Rights Reserved.                                       *
*                                                                    *
* The Initial Developer of the Original Code is PSC.  The Original   *
* Code is Progress IDE code released to open source December 1, 2000.*
*                                                                    *
* The contents of this file are subject to the Possenet Public       *
* License Version 1.0 (the "License"); you may not use this file     *
* except in compliance with the License.  A copy of the License is   *
* available as of the date of this notice at                         *
* http://www.possenet.org/license.html                               *
*                                                                    *
* Software distributed under the License is distributed on an "AS IS"*
* basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. You*
* should refer to the License for the specific language governing    *
* rights and limitations under the License.                          *
*                                                                    *
* Contributors:                                                      *
*                                                                    *
--------------------------------------------------------------------->
<html>
<head>
<meta name="wsoptions" content="no-output">
<title>##GetField('PageTitle')##</title>
##HTMLTagLink('link rel=stylesheet','StyleSheet','type="text/css"')##
</head>

<body ##HTMLAttribute('bgcolor','pagebgcolor')## ##HTMLAttribute('background','PageBackground')##>
<center>

<!-- Report Title -->
<p><strong>##GetField('PageTitle')##</strong><br><br></p>

<script language="SpeedScript">
DEFINE VARIABLE SearchValue     AS CHAR NO-UNDO.
DEFINE VARIABLE CurrentRowids   AS CHAR NO-UNDO.
DEFINE VARIABLE BackRowids      AS CHAR NO-UNDO.
DEFINE VARIABLE TmpUrl          AS CHAR NO-UNDO.
DEFINE VARIABLE MaintOption     AS CHAR NO-UNDO.
DEFINE VARIABLE DelimiterField  AS CHAR NO-UNDO. 
DEFINE VARIABLE JoinParam      AS CHAR NO-UNDO. 
DEFINE VARIABLE FieldName       AS CHAR NO-UNDO.
  
DEFINE VARIABLE UseRowidsInLink AS LOG  INIT  ##getField('JoinLink')## NO-UNDO. 
DEFINE VARIABLE UseNavigation   AS LOG  INIT  ##getField('UseNavigationPanel')## NO-UNDO.
DEFINE VARIABLE UseSubmit       AS LOG  INIT  ##getField('UseSubMit')## NO-UNDO.
DEFINE VARIABLE UseReset        AS LOG  INIT  ##getField('UseReset')## NO-UNDO.
DEFINE VARIABLE UseAdd          AS LOG  INIT  ##getField('UseAdd')## NO-UNDO.
DEFINE VARIABLE UseCancel       AS LOG  INIT  ##getField('UseCancel')## NO-UNDO.
DEFINE VARIABLE UseDelete       AS LOG  INIT  ##getField('UseDelete')## NO-UNDO.
DEFINE VARIABLE UseSearchForm   AS LOG  INIT  ##getField('UseSearchForm')## NO-UNDO.
DEFINE VARIABLE DataObject      AS CHAR INIT  '##getField('DataObject')##' NO-UNDO.
DEFINE VARIABLE DataSourceHdl   AS HANDLE NO-UNDO.

/** Defines properties and starts the super procedure web2/wbdata.p */ 
{src/web2/wbdata.i}
  
setExternalTableList('##getField('ExternalTables')##').  
setForeignFieldList('##getField('ForeignFields')##'). 
   
IF DataObject <> '' THEN 
DO:
  setAppService('##getField('AppService')##').
  startDataObject(DataObject).  
  ##instanceProperties('DataSourceHdl')##  
END.
ELSE DO:
  /** WebRep.p uses dynamic queries and buffers .
      You can use user variables instead of hardcoded values. */         
  setBuffers('##getField('Tables')##').  
  setQueryWhere('##getField('4GLQuery')##').
  setExternalJoinList('##getField('ExternalJoin'##').  
  setExternalWhereList('##getField('ExternalWhere')##').
END.


/* The ForeignFieldList is the only way to link WebObjects that uses SDOs.  
 * It overrides the use of ExternalJoinList and ExternalWhereList for queries.
 * The list consist of comma separated fields (with db.tablename or tablename) 
 * and an optional parameter. 
 * setForeignFieldList('order.custnum').   
 * - This will add "order.custnum = " + get-field(custnum) to the where clause.
 * setForeignFieldList('order.custnum,cust#').   
 * - This will add "order.custnum =  " + get-field(cust#) to the where clause.
 * setForeignFieldList('order.custnum,cust#,order.salesrep')
 * - This will add "order.custnum  = " + get-field(cust#) " and "
                   "order.salesrep = " + get-field(salesrep) to the where clause. 
 * Several lists of commaseparated fields may be separated with | to specify 
 * different foreign fields for different external tables. 
 * Example: Externaltable 1: customer and salesrep   
 *          Externaltable 2: customer
 *          Externaltable 3: salesrep 
 * setExternalTableList('customer,salesrep|customer|salesrep'). 
 * setForeignFieldList('order.custnum,order.salesrep|order.custnum|order.salesrep'). 
 */  
    
/** You can use user variables instead of hardcoded values also for columns */       
setColumns('##getField('Columnlist')##'). 

##overrideColumns('Label')##
##overrideColumns('Format')##
##overrideColumns('Help')##
##genValidationFrame()##
                           
IF UseSearchForm THEN 
DO: 
  /* Set the field to use for search. 
   * Only one field supported 
   * The field used in the searchForm has (name=SearchValue)
   * The corresponding data from searchValue will be used in the selection
   * criteria. 
   * The operator will be GE  */  
  setSearchColumns('##getField('SearchColumns')##'). 

</script>

 <form action="`SelfURL`" method="POST" name="SearchForm">
    <input type="hidden" name="Navigate" value="Search">
    <p><strong>`columnLabel(ENTRY(1,getSearchColumns()))`
    <input type="text" size="20" name="SearchValue" value="`html-encode(get-field('searchValue'))`">
    <input type="submit" name="SubmitBtn" value="Search">
    </strong></p>
    <hr>
 </form>

<script language="SpeedScript">
END. /* IF UseSearchForm THEN DO: */

/** ProcessWebReqest gets the value for Navigate and SearchValue,  */
/** opens the query and outputs the table. */          

RUN ProcessWebRequest.
  
ASSIGN
  TmpUrl         = url-format(?,getContextFields(),?)    
  Delimiterfield = IF INDEX(TmpUrl,"?") > 0
                   THEN ?
                   ELSE "?"
  TmpUrl         = TmpUrl + url-field("CurrentRowids":U,getCurrentRowids(),DelimiterField)
  DelimiterField = IF INDEX(TmpUrl,"?") > 0
                   THEN ?
                   ELSE "?".
                 
/* If we are using a SearchForm we must set the CurrentRowids value  */  
IF UseSearchForm THEN 
DO: 

</script>

<script language="JavaScript">
   { document.SearchForm.href = "`TmpUrl`"; }
</script>

<script language="SpeedScript">
END. /* IF UseSearchForm THEN DO: */
</script>

<form action="`TmpURL`" method="POST" name="DetailForm">  

<input type="hidden" name="Addmode" value="`getUpdateMode() = 'Add':U`">

<table ##HTMLAttribute('bgcolor','TableBGColor')## ##HTMLAttribute('background','TableBackground')## ##HTMLAttribute('border','TableBorder')## >

##EachColumn
  <tr>
  <td><strong>`html-encode(columnLabel('##ColumnName##'))`</strong></td>  
  <td><input text="submit" 
             name="`columnHTMLName('##ColumnName##')`" 
             value="`html-encode(columnStringValue('##ColumnName##'))`" 
            `IF columnReadOnly('##ColumnName##') THEN ' disabled ' ELSE ''`    
             onmouseover="window.status='`html-encode(columnHelp('##ColumnName##'))`';return true"
             onmouseout="window.status='';return true">
  </td>  
  ##IfLinkColumn
  <td>&nbsp;&nbsp;</td>
  <td><input type="button" name="LinkButton" 
       value="##StatusLine##"
         onClick="window.open('`urlLink('##WebObject##','##JoinColumns##')`','##targetframe##')"></td>
  end## 
  </tr>
end##

</table>

<table>

<!--WSS IF getUpdateMode() <> "Add":U AND UseAdd THEN --> 
       <td><input type="submit" name="MaintOption" value="Add"></td>
<!--WSS IF UseSubmit THEN --> 
       <td><input type="submit" name="MaintOption" value="Submit"></td>
<!--WSS IF getUpdateMode() = "Add":U AND UseCancel THEN --> 
       <td><input type="submit" name="MaintOption" value="Cancel"></td>
<!--WSS IF UseReset THEN --> 
       <td><input type="reset" name="MaintOption" value="Reset"></td>
<!--WSS IF getUpdateMode() <> "Add":U AND UseDelete THEN DO: --> 
       <td><input type="submit" name="MaintOption" value="Delete"
         onClick="if (! confirm('Delete this `REPLACE(getDeleteTables(),',',' and ')`'))
                    return false;"></td>
<!--WSS END. /* IF MaintOption <> "Add":U AND UseDelete THEN DO: */ --> 

</table>
</form>
</center>


<script language="SpeedScript">
IF UseNavigation AND MaintOption <> 'Add':U THEN 
DO: 
</script>    
 <div align="center"><center>

 <table border="2">
   <tr>
        <td><a
        href="`TmpUrl%20+%20url-field('Navigate','First',DelimiterField)`"
        onmouseover="window.status='First';return true"
        onmouseout="window.status='';return true"><img
        src="`RootURL`/images/first-au.gif" border="0" width="16"
        height="16"></a></td>
        <td><a
        href="`TmpUrl%20+%20url-field('Navigate','Prev',DelimiterField)`"
        onmouseover="window.status='Previous';return true"
        onmouseout="window.status='';return true"><img
        src="`RootURL`/images/prev-au.gif" border="0" width="16"
        height="16"></a></td>
        <td><a
        href="`TmpUrl%20+%20url-field('Navigate','Next',DelimiterField)`"
        onmouseover="window.status='Next';return true"
        onmouseout="window.status='';return true"><img
        src="`RootURL`/images/next-au.gif" border="0" width="16"
        height="16"></a></td>
        <td><a
        href="`TmpUrl%20+%20url-field('Navigate','Last',DelimiterField)`"
        onmouseover="window.status='Last';return true"
        onmouseout="window.status='';return true"><img
        src="`RootURL`/images/last-au.gif" border="0" width="16"
        height="16"></a></td>
    </tr>
 </table>
 </center></div>
<script language="SpeedScript">
END.  /* IF UseNavigation THEN DO: */

/* Show error messages */
IF AnyMessage() THEN 
DO:
  FieldName = ShowDataMessages().
  /* Set focus if error in a specific field */
  IF FieldName <> "":U THEN 
    HTMLSetFocus("document.DetailForm",FieldName). 
END.
RUN destroyObject. 

##genOverrideDelete()##
 
</script>

</body>
</html>









